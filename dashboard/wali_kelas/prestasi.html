<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Data Prestasi - SB Admin</title>

    <link rel="stylesheet" href="../css/loading.css">
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

    <style>
        .card {
            margin-top: 25px;
            border: 1px solid #0d6efd;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }

        .card-header {
            background-color: #0d6efd;
            color: #fff;
            padding: 1rem 1.25rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .form-label {
            font-weight: 500;
        }

        .add-icon {
            cursor: pointer;
            color: #0d6efd;
            font-size: 20px;
            margin-left: 10px;
            transition: 0.2s ease;
        }

        .add-icon:hover {
            color: #084298;
            transform: scale(1.1);
        }

        .table td input {
            border-radius: 0.375rem;
        }

        .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        .btn-primary:hover {
            background-color: #084298;
            border-color: #084298;
        }

        .action-btns i {
            cursor: pointer;
            margin: 0 5px;
        }

        .action-btns i:hover {
            color: #0d6efd;
        }
        .mt-neg-2 {
            margin-top: -20px;
        }
    </style>
</head>
<body class="sb-nav-fixed">
    <div id="preloader">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-3" href="index.html">Wali Kelas</a>
        <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle"><i class="fas fa-bars"></i></button>
        <div class="ms-auto d-flex align-items-center">
            <form class="d-none d-md-inline-block me-3">
            </form>
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user fa-fw"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><hr class="dropdown-divider" /></li>
                        <li><a class="dropdown-item" href="#">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <a class="nav-link" href="index.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-chart-line"></i></div>
                            Dashboard
                        </a>
                        <a class="nav-link" href="absensi.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-user-check"></i></div>
                            Absensi
                        </a>
                        <a class="nav-link" href="catatan-raport.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-book"></i></div>
                            Catatan Rapot
                        </a>
                        <a class="nav-link" href="input-nilai.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-pen"></i></div>
                            Nilai
                        </a>
                        <a class="nav-link" href="prestasi.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-trophy"></i></div>
                            Prestasi
                        </a>
                        <a class="nav-link" href="ekstrakurikuler.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-running"></i></div>
                            Ekstrakurikuler
                        </a>
                        <a class="nav-link" href="raport.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-file-alt"></i></div>Raport
                        </a>
                    </div>
                </div>
            </nav>
        </div>

        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-6">
                    <h1 class="mt-neg-2">Prestasi Siswa</h1>
                    <div class="card">
                        <div class="card-header">Catat Prestasi Siswa per Tahun Ajaran</div>
                        <div class="card-body">
                            <form id="prestasiForm">
                                <div class="mb-3">
                                    <label for="studentName" class="form-label">Nama Siswa</label>
                                    <select class="form-select" id="studentName" required>
                                        <option disabled selected>Pilih Nama Siswa</option>
                                        <option>Andi</option>
                                        <option>Budi</option>
                                        <option>Citra</option>
                                        <option>Dewi</option>
                                        <option>Dita</option>
                                        <option>Dwi</option>
                                        <option>Fadil</option>
                                        <option>Gilang</option>
                                        <option>Izat</option>
                                        <option>Kiandra</option>
                                        <option>Manisa</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="academicYear" class="form-label">Tahun Ajaran</label>
                                    <input type="text" class="form-control" id="academicYear" placeholder="Contoh: 2023/2024" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Prestasi</label>
                                    <table class="table table-bordered" id="prestasiTable">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 5%">No</th>
                                                <th>Prestasi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td><input type="text" class="form-control" name="prestasi[]" required /></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <span class="add-icon" onclick="addPrestasiRow()" title="Tambah Prestasi">
                                        <i class="fas fa-plus-circle"></i>
                                    </span>
                                </div>
                                <button type="submit" class="btn btn-primary">Simpan Prestasi</button>
                            </form>
                        </div>
                    </div>

                    <!-- Preview Table -->
                    <div class="card mt-4">
                        <div class="card-header">Daftar Data Prestasi</div>
                        <div class="card-body">
                            <table class="table table-striped" id="previewTable">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Siswa</th>
                                        <th>Tahun Ajaran</th>
                                        <th>Prestasi</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let dataList = [];
        let editIndex = -1;

        function addPrestasiRow() {
            const table = document.querySelector("#prestasiTable tbody");
            const rowCount = table.rows.length + 1;
            const row = table.insertRow();
            row.innerHTML = `
                <td>${rowCount}</td>
                <td><input type="text" class="form-control" name="prestasi[]" required /></td>
            `;
        }

        document.getElementById("prestasiForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const name = document.getElementById("studentName").value;
            const year = document.getElementById("academicYear").value;
            const prestasiInputs = document.querySelectorAll('input[name="prestasi[]"]');
            const prestasiList = Array.from(prestasiInputs).map(input => input.value.trim()).filter(p => p);

            const data = { name, year, prestasi: prestasiList };

            if (editIndex >= 0) {
                dataList[editIndex] = data;
                editIndex = -1;
            } else {
                dataList.push(data);
            }

            this.reset();
            document.querySelector("#prestasiTable tbody").innerHTML = `
                <tr><td>1</td><td><input type="text" class="form-control" name="prestasi[]" required /></td></tr>
            `;

            updatePreview();
        });

        function updatePreview() {
            const tbody = document.querySelector("#previewTable tbody");
            tbody.innerHTML = "";

            dataList.forEach((data, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${data.name}</td>
                    <td>${data.year}</td>
                    <td><ul>${data.prestasi.map(p => `<li>${p}</li>`).join("")}</ul></td>
                    <td class="action-btns">
                        <i class="fas fa-edit" onclick="editData(${index})" title="Edit"></i>
                    </td>
                `;
            });
        }

        function editData(index) {
            const data = dataList[index];
            document.getElementById("studentName").value = data.name;
            document.getElementById("academicYear").value = data.year;

            const tableBody = document.querySelector("#prestasiTable tbody");
            tableBody.innerHTML = "";
            data.prestasi.forEach((val, i) => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td><input type="text" class="form-control" name="prestasi[]" value="${val}" required /></td>
                `;
            });

            editIndex = index;
        }
    </script>
</body>
</html>
